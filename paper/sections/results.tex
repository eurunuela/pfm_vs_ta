% !TEX root = ../main.tex

\section{Results}

% \begin{itemize}
%     \item Methods on how we're doing simulations and results (with simulations and experimental data)
%     \begin{itemize}
%         \item Different SNRs and maybe even use CAPs
%         \item Selection of HRF explained if both use the same but it's different from what's used for simulating.
%         \begin{itemize}
%             \item What happens? For example with gamma for simulating.
%         \end{itemize}
%         \item Selection of regularization parameter
%         \begin{itemize}
%             \item Present with real data on a voxel
%         \end{itemize}
%     \end{itemize}
% \end{itemize}

\subsection{Performance based on the regularization parameter}
\label{sec:regpath}

Figure~\ref{fig:sim}A shows the regularization paths of PFM and TA side by side obtained for the spike model in~\eqref{eq:pfm_spike} for the three SNR conditions. Starting from the maximum $\lambda$ corresponding to a null estimate and for decreasing values of $\lambda$, LARS computes a new estimate at the value of $\lambda$ that reduces the sparsity promoted by the \(l_1\)-norm and causes a change in the active set of non-zero coefficients of the estimate (i.e. a zero coefficient of becomes non-zero, or viceversa) as shown in the x-axis of the heatmaps. Vertical black lines depict the selection of the regularization parameter based on BIC, and thus, the colored coefficients indicated by the vertical lines depict the estimated activity-inducing signal $\mathbf{\hat{{s}}}$. Figure~\ref{fig:sim}B illustrates the resulting estimates of the activity-inducing and neuronal-related hemodynamic signals when basing the selection of $\lambda$ on BIC for the three simulated SNR conditions. Given that the regularization paths of both techniques are identical, it can be clearly observed that the BIC-based estimates are identical too for the corresponding $\lambda$. Thus, Figure~\ref{fig:sim}A and B demonstrate that, regardless of the simulated SNR condition, the spike model of both deconvolution algorithms produce identical regularization paths when the same HRF and regularization parameters are applied, and hence, identical estimates of the activity-inducing signal $\mathbf{\hat{{s}}}$ and neuronal-related hemodynamic signal $\mathbf{\hat{{x}}}$. 
Likewise, Figure~\ref{fig:sim}C demonstrates that the regularization paths for the block model in~\eqref{eq:pfm_block} also yield virtually identical estimates of the innovation signals for both PFM and TA methods. Again, the BIC-based selection of $\lambda$ is identical for both PFM and TA. As illustrated in Figure~\ref{fig:sim}D, the estimates of the innovation signal $\mathbf{u}$ also show no distinguishable differences between the algorithms. Hence, Figures~\ref{fig:sim} A-D demonstrate that both PFM and TA yield equivalent regularization paths and estimates of the innovation signal and activity-inducing signal regardless of the simulated SNR condition when applying the same HRF and regularization parameters with the block and spike models.\todo{Last sentence could be skipped and moved to a general conclusion paper in the discussion}

As for selecting $\lambda$ according to the MAD criterion in~\eqref{eq:std}, Figure~\ref{fig:sim}E depicts the estimated activity-inducing, innovation, and activity-related signals for the three simulated SNR settings using the spike model, while Figure~\ref{fig:sim}F shows the estimated signals corresponding to the block model. Both plots in Figure~\ref{fig:sim}E and F depict nearly identical results between PFM and TA with both models. Given that the regularization paths of both techniques are identical, minor differences are owing to the slight dissimilarities in the convergence of the residuals to the estimated noise level of the data.

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\textwidth]{figures/figure_sim.pdf}
    \end{center}
    \caption{(A) Left: Heatmap of the regularization paths of the activity-inducing signals estimated with PFM and TA as a function of $\lambda$ for the simulated data with SNR = 3 dB (x-axis: increasing number of iterations or $\lambda$ as given by LARS; y-axis: time; color: amplitude). Vertical lines denote iterations corresponding to the Bayesian Information Criteria (BIC) optima. (Right) Estimated activity-inducing (blue) and activity-related (green) signals $\lambda$ is selected based on BIC. (B) Same for the block model with estimates for the innovation signals. (C) Estimated activity-inducing, innovation and activity-related (fit, $\mathbf{x}$) signals estimated with PFM (top) and TA (bottom) when $\lambda$ is selected based on the MAD method with the spike model (left) and the block model (right) for the simulated data with SNR = 3 dB.}
\label{fig:sim}
\end{figure}

% Furthermore, we performed the same analysis on experimental data as shown in Figure~\ref{fig:exp} (rows 1-2, 4). Row 1 demonstrates that the PFM and TA regularization paths are identical when deconvolving experimental data, regardless of the deconvolution model (spike or block). Even though tiny differences can be seen between the two methods in the BIC selection of \(\lambda\) in row 4, row 2 proves that the results are practically identical, and differences can be disregarded.

\subsection{Performance on experimental data}

Figure~\ref{fig:rss} depicts the sum of squares difference (SSD) between PFM and TA estimates of the spike (Figure~\ref{fig:rss}A and C) and block (Figure~\ref{fig:rss}B and D) models for the three experimental fMRI datasets: motor, monoband and multiband. It can be seen that the SSD values are virtually negligible (i.e. depicted in yellow) in most of the within-brain voxels and clearly lower than the amplitude of the estimates of the activity-inducing and innovation signals. Based on the maximum value of the range shown in each image, we observe that the similarity between both approaches is more evident for the spike model (with both selection criteria) and the block model with the BIC selection. However, a selection of the regularization parameter $\lambda$ based on the MAD estimate of the noise using the block model produces SSD values that are comparable to those of the innovation signal, and the largest differences ocurr in regions with high vasculature, likely resulting from differences in amplitude of activity-inducing and innovation signals derived from the noisy nature of the fMRI signal in those areas of the brain. \todo[inline]{Expand more on interpretation of this Figure}\todo[inline]{Add figures of lambdas and sigma MAD as supplementary material.}

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\textwidth]{figures/comp_figure.png}
    \end{center}
    \caption{Sum of squares of the differences (SSD) between the estimates obtained with PFM and TA for (A) spike model (activity-inducing signal) and BIC selection of $\lambda$, (B) block model (innovation signal) and BIC, (C) spike model (activity-inducing signal) and MAD, (D) block model (innovation signal) and MAD. SSD maps are shown for the three experimental fMRI datasets: the motor task (Motor), the monoband resting-state (Mono), and the multiband resting-state (Multi) datasets. Note the differences in the maximum value of each figure.}
\label{fig:rss}
\end{figure}

Figure~\ref{fig:task_maps} depicts the results of the analysis of the Motor dataset with the PFM and TA algorithms, as well as a conventional GLM approach. The Activation Time Series (top left), calculated as the sum of squares of all voxel amplitudes (positive vs. negative) for a given moment in time, obtained with PFM and TA show nearly identical patterns. These ATS help to summarize the four dimensional information available in the results across the spatial domain and identify instances of significant BOLD activity. The rows below show the voxel timeseries and the corresponding activity-related, activity-inducing and innovation signals obtained with PFM using the BIC criterion of representative voxels in the regions activated in each of the motor tasks. The TA-estimated time-series are not shown because they were equivalent. The maps shown on the right correspond to statistical parametric map obtained with the GLM for each motor condition ($p < 0.001$) as well as the maps of the PFM and TA estimates at the onsets of individual motor events (indicated with arrows in the timecourse). The estimated activity-related, activity-inducing and innovation signals clearly reveal the activity patterns of each condition in the task, as they exhibit a BOLD response locked to the onset and duration of the conditions. Overall, activity maps of the innovation signal obtained with PFM and TA highly resemble those obtained with a GLM for individual events. Differences between PFM and TA can be disregarded given their close-to-zero values.

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\textwidth]{figures/task_maps.png}
    \end{center}
    \caption{Row 1: Activation time-series of the innovation signals estimated by PFM (in blue) or TA (in red) calculated as the sum of squares of all voxels at every timepoint. Positive-valued and negative-valued contributions were separated into two distinct time-courses. Color-bands indicate the onset and duration of each condition in the task (green: tongue, purple: left-hand finger-tapping, blue: right-hand finger-tapping, red: left-foot toes, orange: right-foot toes). Rows 2-6: time-series of a representative voxel for each task with the PFM-estimated innovation (blue), PFM-estimated activity-inducing (green), and activity-related (i.e., fitted, orange) signals, with their corresponding GLM, PFM, and TA maps on the right. The maps shown on the right are sampled at the time-point labeled with the red arrows and display the innovation signals at that moment across the whole brain.}
\label{fig:task_maps}
\end{figure}

As an illustration of the insights that deconvolution methods can provide in the analysis of resting-state data, Figure~\ref{fig:caps} depicts the CAPs and iCAPs obtained from thresholding and averaging the activity-inducing and innovation signals, respectively, estimated from the resting-state multiband data using PFM with the BIC to select $\lambda$. The activity-inducing CAPS  obtained via deconvolution show spatial patterns of the default mode network (DMN), dorsal attention network (DAN) and visual network (VIS) that highly resemble the maps obtained with conventional seed correlation analysis using Pearson correlation, and the CAPs based on the amplitude of the signal (i.e. with no deconvolution). With deconvolution, the CAPs seem to depict less spurious voxels (mainly negative) and more accurate spatial delineation (i.e. less smoothness) than those obtained from the original data, while mantaining the structure of the networks. On the other hand, the spatial patterns of the iCAPs based on the innovation signals using the block model yield complementary information to that obtained with activity-inducing signal since iCAPs allows to reveal regions with synchronous innovations, i.e. with the same upregulating and downregulating events. For instance, it is interesting to observe that the structure of the visual network nearly dissapears in its corresponding iCAPs, suggesting the existence of different temporal neuronal patterns across voxels in the primary and secondary visual cortices. 

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\textwidth]{figures/caps.png}
    \end{center}
    \caption{Activity-inducing CAPs (left) and innovation CAPs (right) obtained with the PFM-estimated activity-inducing and innovation signals, respectively. Time-points selected with a 95th percentile threshold are shown over the average time-series (blue) in the seed region (white-cross) and the deconvolved signal (orange). CAPs and seed correlation maps are illustrated in the center.}
\label{fig:caps}
\end{figure}

\todo[inline]{What about computation time? Do something similar as Hamza in his PhD?}